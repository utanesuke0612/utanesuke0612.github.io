---
layout: post
title: Nano01(自動運転)-U03-Lesson12-TensorFlow
date: 2019-01-01 02:02:04
categories: self-driving(自動運転)
tags: self-driving
---
* content
{:toc}

![image](https://user-images.githubusercontent.com/18595935/51788078-3d26cf80-21bd-11e9-9fd2-023aaab32ad2.png)

# 6. Installing TensorFlow

Conda中安装TensorFlow：

```python
conda create --name=IntroToTensorFlow python=3 anaconda
source activate IntroToTensorFlow
conda install -c conda-forge tensorflow
```

测试代码1：

```python
import tensorflow as tf

# Create TensorFlow object called tensor
hello_constant = tf.constant('Hello World!')

with tf.Session() as sess:
    # Run the tf.constant operation in the session
    output = sess.run(hello_constant)
    print(output)
```

输出`b'Hello World!'`

测试代码2：

```python
import tensorflow as tf
import numpy as np

# 使用 NumPy 生成假数据(phony data), 总共 100 个点.
x_data = np.float32(np.random.rand(2, 100)) # 随机输入
y_data = np.dot([0.100, 0.200], x_data) + 0.300

# 构造一个线性模型
# 
b = tf.Variable(tf.zeros([1]))
W = tf.Variable(tf.random_uniform([1, 2], -1.0, 1.0))
y = tf.matmul(W, x_data) + b

# 最小化方差
loss = tf.reduce_mean(tf.square(y - y_data))
optimizer = tf.train.GradientDescentOptimizer(0.5)
train = optimizer.minimize(loss)

# 初始化变量
init = tf.initialize_all_variables()

# 启动图 (graph)
sess = tf.Session()
sess.run(init)

# 拟合平面
for step in range(0, 201):
    sess.run(train)
    if step % 20 == 0:
        print(step, sess.run(W), sess.run(b))

# 得到最佳拟合结果 W: [[0.100  0.200]], b: [0.300]
```

```python
0 [[-0.29607844  0.49112239]] [ 0.74048108]
20 [[-0.0404522   0.21079057]] [ 0.36591059]
40 [[ 0.06075135  0.19667548]] [ 0.32181653]
60 [[ 0.08866727  0.19777994]] [ 0.3069748]
80 [[ 0.09665523  0.19910237]] [ 0.30218849]
100 [[ 0.09899885  0.19968568]] [ 0.3006795]
120 [[ 0.0996977  0.1998966]] [ 0.30020973]
140 [[ 0.09990822  0.19996706]] [ 0.3000645]
160 [[ 0.09997206  0.19998969]] [ 0.3000198]
180 [[ 0.09999147  0.1999968 ]] [ 0.30000606]
200 [[ 0.09999739  0.19999902]] [ 0.30000183]
```

# 7. 分析示例代码：

```python
import tensorflow as tf

# Create TensorFlow object called hello_constant
hello_constant = tf.constant('Hello World!')

with tf.Session() as sess:
    # Run the tf.constant operation in the session
    output = sess.run(hello_constant)
    print(output)
```

**Tensor 张量：**

在TensorFlow中，数据不是以int string等存储，而是被包装在一个叫做tensor的对象中，比如上面的`hello_constant = tf.constant('Hello World!')`，`hello_constant`就是一个0维的string tensor，另外还可以以其他的类型，其他的维度来定义tensor:

```python
# A is a 0-dimensional int32 tensor
A = tf.constant(1234) 
# B is a 1-dimensional int32 tensor
B = tf.constant([123,456,789]) 
# C is a 2-dimensional int32 tensor
C = tf.constant([ [123,456,789], [222,333,444] ])
```

**Session 会话：**

我们把上面运行的代码，可以用下面的图graph来描述：

![image](https://user-images.githubusercontent.com/18595935/51788570-b8d74b00-21c2-11e9-9f66-ea8390b78c8f.png)

一个TensorFlow Session是一个运行上述图的一个环境，session负责将操作指派给GPU或是CPU，比如下面的代码：

```python
with tf.Session() as sess:
    output = sess.run(hello_constant)
    print(output)
```

上面的代码将张量hello_constant中的值计算出来，首先使用`tf.session`生成一个session，再使用`sess.run()`提取出张量`hello_constant`中的值。

```python
# A is a 0-dimensional int32 tensor
A = tf.constant(1234) 
# B is a 1-dimensional int32 tensor
B = tf.constant([123,456,789]) 
# D is a 0-dimensional string tensor
D = tf.constant("Hello World!")

with tf.Session() as sess:
    # Run the tf.constant operation in the session
    output = sess.run(A)
    print("constant(1234):            ",type(output))
    
    output = sess.run(B)
    print("constant([123,456,789]):   ",type(output))
    
    output = sess.run(D)
    print("constant('Hello World!'):  ",type(output))
    
```

```python
constant(1234):             <class 'numpy.int32'>
constant([123,456,789]):    <class 'numpy.ndarray'>
constant('Hello World!'):   <class 'bytes'>
```

# 8. Quiz: Tensorflow Input

