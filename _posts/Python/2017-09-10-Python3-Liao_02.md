---
layout: post
title: Python入门-Liao-02-字符串与编码
date: 2017-09-09 22:46:59
categories: Python
tags: 廖雪峰教程
---
* content
{:toc}

> [Python-Liao-XX...]系列,系列根据廖雪峰的python3初级教程学习整理。


计算机内部只能处理0和1，如果要处理文本，就必须先把文本处理为数字才能处理。
- ASCII码最初是美国人用来处理英文字母的，只有127个用来表示英文大小写字母,数字,符号等。比如大写字母 A 的编码是 65，小写字
母 z 的编码是 122。

- 中文 GB2312编码 / 日文 Shift_JIS ：显然如果要处理中文日文这种还有巨多字符的文字的话，127个编码的ASCII肯定是不够的，至少
需要2个字节，即65535中编码，并且不能与已有ASCII 编码冲突。

- **问题**: 各个国家制定了各自的标准，如果单纯显示一个国家文字是没有问题，如果是多国语言混合文本，比如中文日文混合的话，
用GB2312解码就会出现乱码。

- **解决方式**:Unicode，Unicode把所有语言都统一到一套编码里，这样就不会再有乱码问题了。现代操作系统和大多数变成语言都是直接支持Unicode。

# 1. Unicode与ASCII码的区别

| ASCII        | Unicode                                      |
|:-------------|:---------------------------------------------|
| 占用一个字节 | 通常占用两个字节                             |
| 无法表示汉字 | 两个字节表示汉字                             |
| A：01000001  | A:00000000 01000001，前面补0至到两个byte为止 |

# 2. UTF-8编码

Unicode采用固定2byte的方式进行存储，那如果大量存储英文字符的情况下，会造成近一倍的空间浪费，用Unicode 编码比 ASCII 编码需要多一倍的存储空间，在存储和传输上就十分不划算。
本着节约的精神，又出现了把Unicode码转换为可变长编码的UTF-8， UTF-8编码把一个 Unicode 字符根据不同的数字大小编码成 1-6 个字节，常用的英文字母被编码成 1 个字节，汉字通常是 3 个 字节，只有很生僻的字符才会被编码成 4-6 个字节。如果你要传输的文 本包含大量英文字符，用 UTF-8 编码就能节省空间

| 字符 |  ASCII   |      Unicode      |           UTF-8            |
|:---- |:-------- | ----------------- | -------------------------- |
| A    | 01000001 | 00000000 01000001 | 01000001                   |
| 中   | 无编码        | 01001110 00101101 | 11100100 10111000 10101101 |


下面看一个实际的例子，分别在Unicode文件和UTF-8文件中表示 `ABC中`

- Unicode中二进制如下，占用10byte:

```
FF FE 41 00 42 00 43 00 2D 4E
```
1. 固定字符`FF FE`，识别子表示UTF-16LE（little endian UTF-16）
2. `41 00 42 00 43 00` 分别表示`ABC`，各占用2个byte
3. `2D 4E` 表示汉字 `中`，占用2个byte
4. 编码是little endian，故正确顺序是 `0041 0042 0043 4E2D`.

- UTF-8中二进制如下，占用9byte：

```
EF BB BF 41 42 43 E4 B8 AD
```
1. 固定字符 `EF BB BF`，识别子表示UTF-8。
2. `41 42 43` 是英文`ABC`，只占用1个byte。
3. `E4 B8 AD` 汉字`中`，占用3个byte。
4. 因为ASCII码最多是127个，故最大为`7F`，超出这个范围，就是多字节的编码方式。根据不同的数字大小,判断当前是几个字节的编码。

UTF-8 编码有一个额外的好处，就是 ASCII 编码实际上可以被看成是UTF-8编码的一部分， 所以大量只支持ASCII 编码的历史遗留软件可以在 UTF-8 编码下继续工作。

关于UTF-8更详细的可以参考[wiki UTF-8](https://ja.wikipedia.org/wiki/UTF-8).


# 3. 计算机系统通用的字符编码工作方式
在计算机内存中，统一使用 Unicode 编码，当需要保存到硬盘或者需要 传输的时候，就转换为 UTF-8 编码。
> 使用Unicode，因为是固定两个byte编码，便于处理，保存到硬盘或是传输时，需要尽量少的byte数，采用UTF-8编码。

用记事本编辑的时候， 从文件读取的 UTF-8 字符被转换为 Unicode 字符到内存里， 编辑完成后， 保存的时候再把 Unicode转换为UTF-8 保存到 文件，这个工作都是记事本完成的。

![image](https://user-images.githubusercontent.com/18595935/30381035-3c2fc260-98d6-11e7-9c45-3faac106792e.png)

同样通过浏览器时也类似，服务器会把动态生成的Unicode内容转换为UTF-8便于传输，传输给浏览器。
所以你看到很多网页的源码上会有类似<meta charset="UTF-8" />的信息， 表示该网页正是用的 UTF-8 编码。

![image](https://user-images.githubusercontent.com/18595935/30381079-55785458-98d6-11e7-89ff-5f9613fa0c36.png)



# 4. Python的字符串

最新的 Python 3 版本中，字符串是以 Unicode 编码的，也就是说， Python 的字符串支持多语言。例如：

```python
In [48]: print("I love 中文 と にほんご")
I love 中文 と にほんご
```

chr()和ord()提供字符和整数之间的相互转换，如下：

```python
In [49]: ord("A")
Out[49]: 65

In [50]: ord("中")
Out[50]: 20013

In [51]: chr(65)
Out[51]: 'A'

In [52]: chr(20013)
Out[52]: '中'
```


在Python中字符串类似是str，在内存中以Unicode编码，一个字符对应若干个字节。如果要在网络上传输，或者保存到磁盘上，就需要把 str 变为以字节为单位的 bytes。

> 获取size方式：

```python
>>> import sys
>>> x = 2
>>> sys.getsizeof(x)
```

python中，对bytes类型的数据，用带b前缀的单引号或双引号表示，例如`x = b"ABC"`。
注意区分'ABC'和 b'ABC'，前者是 str，后者虽然内容显示得和前者一 样，但 bytes 的每个字符都只占用一个字节。
str代表的是字符，bytes代表的是字节。

## 4.1 编码 encode()
通过encode编码为指定的bytes

```pytho
In [71]: 'ABC'.encode('ascii')
Out[71]: b'ABC'

In [72]:  '中文'.encode('utf-8')
Out[72]: b'\xe4\xb8\xad\xe6\x96\x87'
```

1. 纯英文的 str 可以用 ASCII 编码为 bytes， 内容是一样的。
2. 含有中文的 str 可以用 UTF-8 编码为 bytes。
3. 含有中文的 str 无法用 ASCII 编码，因为中文编码的范围超过了 ASCII 编码的范围，Python 会报错。
4. 在 bytes 中，无法显示为 ASCII 字符的字节，用`\x##`显示，例如`b'\xe4\xb8\xad\xe6\x96\x87'`。


## 4.2 解码 decode()
反过来，如果我们从文件或是传输中读取了字节流，那么读取到的就是bytes，需要把bytes转换为str。
如下代码:

```
In [75]: b'ABC'.decode('ascii')
Out[75]: 'ABC'

In [77]: b'\xe4\xb8\xad\xe6\x96\x87'.decode('utf-8')
Out[77]: '中文'
```

输出的是str类型数据。


## 4.3 len()取长度函数

针对str取长度，则取得的是字符数，针对bytes取长度，获得的是字节byte数。
一个中文字符，通过utf-8编码后占用三个字节。

```python
In [78]: len('ABC')
Out[78]: 3

In [79]: len(b'ABC')
Out[79]: 3

In [80]: len('中文')
Out[80]: 2

In [81]: len('中文'.encode('utf-8'))
Out[81]: 6

```

在操作字符串时，我们经常遇到 str 和 bytes 的互相转换。为了避免乱 码问题，应当`始终坚持使用 UTF-8 编码对 str 和 bytes 进行转换`。

# 5. Python 源代码的编码
由于Python代码本身就是文本文件，所以代码中如果含有汉字字符的话，需要用UTF-8保存。
当Python解释器读取的时候，为了让它按照UTF-8方式读取，通常在程序前加上如下两行：

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
```
- 第一行告诉Linux/OS 系统，这是一个Python可执行程序，Windows会自动忽略该注释。
- 第二行告诉Python解释器，按照UTF-8编码读取源代码，否则中文下会乱码。



# 6. 格式化字符串

在 Python 中，采用的格式化方式和 C 语言是一致的，用%实现，举例如 下：

```python
In [82]: print("hi,%s, I have $%d dollars" % ("lijun",24))
hi,lijun, I have $24 dollars

```
%运算符就是用来格式化字符串的。
在字符串内部，%s 表示用字符串替换，%d 表示用整数替换，有几个%?占位符，后面就跟几 个变量或者值，顺序要对应好。
如果只有一个%?，括号可以省略。

常见的占位符有：`%d 整数 %f 浮点数 %s 字符串 %x 十六进制整数`
格式化整数和浮点数还可以指定是否补 0 和整数与小数的位数：

```python
>>> '%2d-%02d' % (3, 1)
' 3-01'
>>> '%.2f' % 3.1415926
'3.14'
```


如果你不太确定应该用什么，%s永远起作用，它会把任何数据类型转换 为字符串：

```python
>>> 'Age: %s. Gender: %s' % (25, True)
'Age: 25. Gender: True'
```

有些时候，字符串里面的%是一个普通字符怎么办？这个时候就需要转 义，用%%来表示一个%：

```python
>>> 'growth rate: %d %%' % 7
'growth rate: 7 %'
```

关于格式化字符串，可以使用format函数，以前总结过一篇。[format的使用](http://qiita.com/utanesuke/items/8f31753a353195da1a0f).


# 7. **练习**:

小明的成绩从去年的 72 分提升到了今年的 85 分， 请计算小明成绩提升 的百分点，并用字符串格式化显示出'xx.x%'，只保留小数点后 1 位：

```python

In [92]: a = 72

In [93]: b = 85

In [95]: up = (b-a)/b * 100

In [96]: up
Out[96]: 15.294117647058824

In [97]: print("%2.1f%%" % up)
15.3%
```

# 8. 小结

Python 3 的字符串使用 Unicode，直接支持多语言。
str 和 bytes 互相转换时， 需要指定编码。 最常用的编码是 UTF-8。
Python 当然也支持其他编码方式，比如把 Unicode 编码成 GB2312：

```
>>> '中文'.encode('gb2312')
'\xd6\xd0\xce\xc4'
```

但这种方式纯属自找麻烦，如果没有特殊业务要求，请牢记仅使用 UTF-8 编码。

格式化字符串的时候，可以用 Python 的交互式命令行测试，方便快捷。
